
from pwnlib.elf import elf
from core.androhelper import *
from core.malware.utils import check_header

class Anubis:

    def __init__(self, apk_path, output_dir):

        self.known_packages = ['wocwvy.czyxoxmbauu.slsa','kijxlnbftwdhbbet.eaafsym.fziuffcjyjetmqxsmcd',
                               'tlnulyndib.gidwqjoyzpmtrlz.gnrqdyzuns', 'bbhzprkmn.ouktwsybqlijg.rpmyqy',
                               'imjrqkqnugwo.lxrjr.pkdyqhh', 'efqutodrmhkck.jabatumhtihjjzntome.wmniiaogsit',
                               'hbo.jcupwrftuhmgktiylxsjqw.pcyonnqfenimdqgshy',
                               'ansdandnnasd.ashdgajwasgdafsfdhgasfdhg.nabvsbndvasbndvasnb',
                               'gcfscmmtue.mdzrsksczphmec.syq', 'qkrml.mwldzzg.tbplmj',
                               'ianlesiexoaso.xxhapabxpylaw.nnsuqiucmpsqeoferdmymhgpg',
                               'nwnglclfrcifyzdl.phjglhiyjpkrlyqpjbleouctsy.lpiddkccpzeayjedfosaable',
                               'com.gxnsynkqscax.zlculdjqusdk', 'jpxim.tmes.elwiynw',
                               'qoifqqhf.nuhnftdmleutwtwhagycgwtmog.nwijtiepdcwwzjmpa',
                               'fepl.coglbzmmchlabr.dsjkeoxokzwuzn', 'aawtbrj.lsyifadzwuyhcq.zffqxcrtbmfqix',
                               'ums.znyusx.uedxybqjylqquowulalgmppymf', 'rzccqg.sagqdra.zge', 'ggesbh.pvxvaw.xltji',
                               'lqk.chno.hqau', 'rdpdf.zptp.bjx', 'com.tudrzewejzvz.eyurzyb', 'avzmgaz.kbgydzh.ydoewn',
                               'umpjbjiak.mgswpevilx.bsvtwgqcis', 'mgmyzejuvvkghm.jjpdggysholak.rwkusfzvykmclgy',
                               'wteu.cjvow.ldkanccrhcxhrj', 'com.android.vending', 'com.turenak.ch',
                               'gohcthplmgmyrcnhcgsxtysyue.rqjgllnxahaafqsyplz.lcoguawmyxbdzriqeiczstw',
                               'com.eojapij.itsysm', 'akowpynmcfnetbhrtkfk.ggojmkcs.zfhjuwobkab',
                               'zrzxrdogu.swblzeyazmplxnlo.dtaohnnqugctnjlffyjohaq', 'psudwnk.vtiacueicuqzs.laokhep',
                               'wocwvy.czyxoxmbauu.slsa', 'bqehgzgqygllillzks.lpugttkubu.erpwzdxnhtfmqwy',
                               'lsdkkx.ylklvnxalzenwy.bwgoejyyaagyh', 'wocwvy.czyxoxmbauu.slsa', 'com.waveyloa.it',
                               'question.another.scrub', 'ltvpzw.qjsenilrfznsna.bbwkgwsmorryf',
                               'wocwvy.czyxoxmbauu.slsa', 'com.vfhgstw.esnkrp', 'alter.erode.tent', 'provide.human.fine',
                               'com.hsjgwd.hgvjxepj', 'wocwvy.czyxoxmbauu.slsa', 'com.mdprwgkhs.rjzskfpm',
                               'com.ocwnkslfuxe.gwnydeqlxbdi', 'wocwvy.czyxoxmbauu.slsa', 'com.hwrzhofbm.hymcyv',
                               'wocwvy.czyxoxmbauu.slsa', 'glance.bright.raw', 'com.delnwrhwyej.hzfyiwjpf',
                               'com.etkrutbg.rmcbqsaml', 'com.emsqgqvonlad.rpydkfcdhwd', 'com.ajxhzuvpkqev.pbhgcfavujxc',
                               'com.kequdn.juynoiua', 'com.izjctdlk.dzqidfrsuvt', 'hire.immense.hurt',
                               'host.jeans.giant', 'com.vrhtlew.akoguymxeojk', 'com.inzfohvlqln.adloadov',
                               'tiny.notice.morning', 'ehrw.abizvfina.mjsltfpxlx', 'drip.neck.license',
                               'com.wolewrnfy.pqnukozeimz', 'day.cup.clog', 'anu_bispro.app', 'bid.monkey.glove',
                               'excuse.attract.balance', 'com.example.livemusay.mess', 'salmon.minute.shed',
                               'guide.plunge.private', 'com.thcernurz.tdevjzf', 'com.eaknagiox.xiaogbvrlam',
                               'com.wktnqdhpa.bkjvsvw', 'com.irbylhvbakc.qxjdkg', 'com.khpohrdumnj.wdpilonzsna',
                               'expire.match.now', 'visit.horse.topple', 'reason.build.priority',
                               'wocwvy.czyxoxmbauu.slsa', 'com.dkflrjqbd.peyeyqpd', 'sound.toddler.only',
                               'interest.picnic.rate', 'raw.concert.arm', 'wocwvy.czyxoxmbauu.slsa',
                               'grow.provide.sauce', 'com.ypumpkj.grxboc', 'anubis.bot.myapplication',
                               'sfgvwef.fewrfe.gfdgdddrtr', 'ticket.excite.salon', 'kali.logo.com']

        self.known_strings = ['**startbrurl**', '|Request USSD is executed (', 'htmllocker', 'lock_amount',
                              'exitdagjhadfjedgjsfhexitlgdgsfhafg',
                              '/fafa.php?f=', 'at.spardat.bcrmobile', 'at.spardat.netbanking','/o1o/a1.php',
                              '/o1o/a2.php', '/o1o/a3.php', '/o1o/a4.php', '/o1o/a5.php', '/o1o/a6.php',
                              '/o1o/a7.php', '/o1o/a8.php', '/o1o/a9.php', '/o1o/a10.php', '/o1o/a11.php',
                              '/o1o/a12.php', '/o1o/a13.php', '/o1o/a14.php', '/o1o/a15.php',
                              'http://ktosdelaetskrintotpidor.com', 'http://sositehuypidarasi.com',
                              'http://cdnjs.su', 'vkladmin', 'zanubis',
                              'The system does not work correctly, you need to enable access to the statistics',
                              'For correct operation of the system, you need to get the coordinates, you need to '
                              'enable geolocation', 'https://twitter.com/qweqweqwe', 'Fattura', '.AnubisCrypt',
                              'Cryptolocker', 'del_sws', 'tuk_tuk=', 'RAT_command', 'startscreenVNC' ]

        self.known_classes = []

        self.apk_path = apk_path
        self.a, self.d, self.dx = AnalyzeAPK(self.apk_path)
        self.output_dir = output_dir
        self.score = 0

    def check(self):
        self.score = 0

        if self.a.get_package in self.known_packages:
            # Known anubis package
            self.score = self.score + 1

        for string in self.known_strings:
            try:
                if next(self.dx.find_strings(string=string)):
                    # known "string" founded
                    self.score += 1
            except Exception as e:
                # No element
                continue

        return self.score
